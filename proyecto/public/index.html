<!DOCTYPE html>
<html ng-app='miapp'>
<head>
   <meta charset='utf-8'>
   <script src="angular.min.js"></script>
   <script src="ngStorage.min.js"></script>
   <style>
      #opcion1{
	      background:url(sprite.png) 0 0;
		  width:35px;
		  height:35px;
		  list-style-type:none;
	  }
	  #opcion1:hover{
	      background:url(sprite.png) -35px 0;
		  cursor:pointer;
	  }
   </style>
</head>
<body ng-controller='control1'>
	<label for="expresion">Ingresar expresion: </label>
	<input type="text" placeholder="ExpresiÃ³n" id="expresion" value=""
	    ng-model="dato.expresion" ng-change="buscarE()">
		{{respuesta}}
		

	<ul>
	   <li id="opcion1" ng-click='enviar()'></li>
	</ul>
	<ol>
	  <li ng-repeat='item in coincidencias'>{{item}}
	  	  <a href="" ng-click='dato.expresion=item'>{{item}}</a></li>
	</ol>
	<ol>
	  <li ng-repeat='item in lista'>{{item}}
      </li>
	</ol>
    <script>
	    var miapp=angular.module('miapp',['ngStorage'])
		.controller('control1',function($scope,$http,$localStorage){
		   $scope.dato={expresion:''};
		   $scope.lista=[];
		   if ($localStorage.lista!=null){
		   $scope.lista=$localStorage.lista;}
		   $scope.coincidencias=[];
		   $scope.respuesta=0;
		   $scope.cargar=function(){
		   		$scope.dato.expresion=item;
		   }
		   $scope.buscarE=function(){
		      var j=0;
			  $scope.coincidencias=[];
			  if($scope.dato.expresion!='')
		      for(var i=0;i<$scope.lista.length;i++){
			  if($scope.dato.expresion==
			          $scope.lista[i].substring(0,
				      $scope.dato.expresion.length)){
					  $scope.coincidencias[j]=$scope.lista[i];
                      j++;						
			       }		  
			  }
		   }
		   $scope.enviar=function(){
		      $http.post('/miservicio',$scope.dato)
		        .then(function(res){
		             $scope.respuesta=res.data.id;
		             FOR(var i=0;i<$scope.lista.length;i++){
		             	if($scope.dato.expresion===$scope.lista[i]){
		             		break;
		             	}
		             }
		             if(i==$scope.lista.length){
					 $scope.lista.push($scope.dato.expresion);
			         $localStorage.lista=$scope.lista;
			       }
			     $scope.dato.expresion='';
			     $scope.coincidencias=[];
		        });
				
		   }
		});
	</script>
</body>
</html>